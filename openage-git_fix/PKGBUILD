# Maintainer: fzerorubigd <fzero@rubi.gd>
# Contributor: Emmanuel Gil Peyrot <linkmauve@linkmauve.fr>

_pkgbase='openage'
pkgname="$_pkgbase-git_fix"
pkgver=v0.3.0.r844.g7e65549a
pkgrel=1
pkgdesc='A free (as in freedom) clone of the Age of Empires II engine'
arch=('i686' 'x86_64')
url='http://openage.sft.mx/'
license=('GPL3')
depends=('python' 'libgl' 'libepoxy' 'ftgl' 'fontconfig' 'sdl2' 'sdl2_image' 'opusfile')
makedepends=('git' 'cmake' 'python-pillow' 'gcc' 'cython' 'python-pygments' 'python-numpy' 'opus-tools')
optdepends=('python-pillow: for the media convert script'
            'python-numpy: for the media convert script'
            'opus-tools: for the media convert script'
            'ttf-dejavu: for text display, but you can use any font')
provides=('openage')
conflicts=('openage')

source=("$_pkgbase::git+https://github.com/SFTtech/openage"
        "https://github.com/FabioLolix/PKGBUILD/blob/master/openage-git_fix/openage.desktop")
md5sums=('SKIP'
         'de6ce50efd3c33b85f27d67ebda16d16')

pkgver() {
  cd "$srcdir/$_pkgbase"
  git describe --long | sed 's/\([^-]*-g\)/r\1/;s/-/./g'
}

prepare() {
  cd "$srcdir/$_pkgbase"
  mkdir -p build
}

build() {
  cd "$srcdir/$_pkgbase/build"
  cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release ..
  make -j 8
}

package() {
  cd "$srcdir/$_pkgbase/build"
  make DESTDIR="$pkgdir/" install
  mkdir -p $pkgdir/usr/bin
  cp "$srcdir/$_pkgbase/run" $pkgdir/usr/bin/openage
  mv $pkgdir/usr/lib64/* $pkgdir/usr/lib/
  rmdir $pkgdir/usr/lib64
  #rm $pkgdir/usr/share/pixmaps/openage.png
  #cp $pkgdir/usr/share/openage/logo/crown.svg $pkgdir/usr/share/pixmaps/openage.svg
  rm $pkgdir/usr/share/applications/openage.desktop
  install $srcdir/openage.desktop $pkgdir/usr/share/applications/
}

# vim:set ts=2 sts=2 sw=2 et:
