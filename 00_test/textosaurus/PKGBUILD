# Maintainer: Fabio 'Lolix' Loli <lolix@disroot.org> -> https://github.com/FabioLolix

pkgname=textosaurus
epoch=1
pkgver=0.9.5
pkgrel=1
pkgdesc="Simple cross-platform text editor based on Qt and Scintilla"
arch=('x86_64' 'i686')
url="https://github.com/martinrotter/textosaurus"
license=(GPL3)
depends=('qt5-base' 'qt5-svg')
makedepends=('git' 'qt5-tools')
provides=('textosaurus')
conflicts=('textosaurus' 'textosaurus-git')
replaces=('textilosaurus')
_commit=2103ebd7e8cd726ed8c067cf65db0f926b16131d
source=("git+https://github.com/martinrotter/textosaurus#commit=$_commit"
        "git+https://github.com/martinrotter/scintilla"
        "git+https://github.com/martinrotter/transka.git"
        "git+https://github.com/martinrotter/7za.git"
        "git+https://github.com/martinrotter/nsis.git"
        "git+https://github.com/martinrotter/sed.git")
md5sums=('SKIP'
         'SKIP'
         'SKIP'
         'SKIP'
         'SKIP'
         'SKIP')

pkgver() {
  cd $pkgname
  git describe --tags | sed 's/-/+/g'
}

prepare() {
  cd "${srcdir}"
  git submodule init

  git config -f .gitmodules 'submodule.resources/scripts/transka.url' "${srcdir}/transka"
  git config -f .gitmodules 'submodule.resources/scripts/7za.url' "${srcdir}/7za"
  git config -f .gitmodules 'submodule.resources/scripts/nsis.url' "${srcdir}/nsis"
  git config -f .gitmodules 'submodule.resources/scripts/sed.url' "${srcdir}/sed"
  git config 'submodule.src/libtextosaurus/3rd-party/scintilla.url' "${srcdir}/scintilla"

#[submodule "resources/scripts/transka"]
#	path = resources/scripts/transka
#	url = https://github.com/martinrotter/transka.git
#[submodule "resources/scripts/7za"]
#	path = resources/scripts/7za
#	url = https://github.com/martinrotter/7za.git
#[submodule "resources/scripts/nsis"]
#	path = resources/scripts/nsis
#	url = https://github.com/martinrotter/nsis.git
#[submodule "resources/scripts/sed"]
#	path = resources/scripts/sed
#	url = https://github.com/martinrotter/sed.git
#[submodule "src/3rd-party/scintilla"]
#	path = src/3rd-party/scintilla
#	url = https://github.com/martinrotter/scintilla.git

#  git submodule sync
  git submodule update
}

build() {
  cd "${srcdir}/${pkgname}"
  qmake build.pro -r CONFIG+=release PREFIX=/usr
  make
}

package() {
  cd "${srcdir}/${pkgname}"
  make install INSTALL_ROOT="${pkgdir}/"
}
